{% load static %}

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- Select2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<!-- Select2 JS -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

<div class="agac-urunler-container">
    <table class="agac-urunler-table" style="border-collapse: collapse; width: 100%; margin-top: 10px;">
        <thead>
            <tr>
                <th style="padding: 8px; border: 1px solid #ddd; background-color: #f5f5f5;">Ürün ID</th>
                <th style="padding: 8px; border: 1px solid #ddd; background-color: #f5f5f5;">Ürün Adı</th>
                <th style="padding: 8px; border: 1px solid #ddd; background-color: #f5f5f5;">Stok Adedi</th>
                <th style="padding: 8px; border: 1px solid #ddd; background-color: #f5f5f5;">Ağaç Adedi</th>
                <th style="padding: 8px; border: 1px solid #ddd; background-color: #f5f5f5;">İşlemler</th>
            </tr>
        </thead>
        <tbody id="agacUrunlerBody">
            {% for urun in urunler %}
            <tr class="urun-row" data-urun-id="{{ urun.id }}">
                <td style="padding: 8px; border: 1px solid #ddd;">{{ urun.id }}</td>
                <td style="padding: 8px; border: 1px solid #ddd;">{{ urun.isim }}</td>
                <td style="padding: 8px; border: 1px solid #ddd;">{{ urun.stok_adet }}</td>
                <td style="padding: 8px; border: 1px solid #ddd;">
                    <input type="number" class="agac-adet-input" value="{{ urun.agac_adet }}" min="0" required
                           style="width: 80px; padding: 4px;">
                </td>
                <td style="padding: 8px; border: 1px solid #ddd;">
                    <button type="button" class="button" onclick="removeUrunRow(this)">
                        <i class="fas fa-trash"></i> Sil
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 10px;">
        <button type="button" class="button" onclick="showUrunSecPopup()">
            <i class="fas fa-plus"></i> Yeni Ürün Ekle
        </button>
    </div>

    <!-- Ürün Seçme Popup -->
    <div id="urunSecPopup" class="modal" style="display: none;">
        <div class="modal-content" style="width: 500px;">
            <h3>Ürün Seç</h3>
            <select id="urunSelect" style="width: 100%;">
                <option value="">Ürün Seçin...</option>
                {% for urun in all_products %}
                <option value="{{ urun.id }}" data-stok="{{ urun.adet }}">
                    {{ urun.id }} : {{ urun.isim }} - {{ urun.adet }}
                </option>
                {% endfor %}
            </select>
            <div style="margin-top: 10px;">
                <button type="button" class="button" onclick="addSelectedUrun()">Ekle</button>
                <button type="button" class="button" onclick="closeUrunSecPopup()">İptal</button>
            </div>
        </div>
    </div>
</div>

<style>
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    border-radius: 4px;
}

.select2-container {
    width: 100% !important;
    z-index: 1051;  /* Modal'ın üstünde görünmesi için */
}

.select2-selection__rendered {
    line-height: 31px !important;
}

.select2-container .select2-selection--single {
    height: 35px !important;
}

.select2-selection__arrow {
    height: 34px !important;
}

/* Admin paneline uygun buton stilleri */
.button {
    background: #79aec8;
    padding: 10px 15px;
    border: none;
    border-radius: 4px;
    color: #fff;
    cursor: pointer;
}

.button:hover {
    background: #609ab6;
}

button.button[onclick*="removeUrunRow"] {
    background: #ba2121;
}

button.button[onclick*="removeUrunRow"]:hover {
    background: #a41515;
}
</style>

<!-- Ürünler verisi için hidden input -->
<input type="hidden" id="agacUrunlerData" name="urunler" value="{{ urunler|safe }}">

<!-- Admin JS dosyası -->
<script src="{% static 'admin/js/agac_admin.js' %}"></script> 